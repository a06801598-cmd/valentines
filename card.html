<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Portrait Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
      min-height: 100vh;
      font-family: 'Courier New', monospace;
      color: #fff;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      letter-spacing: 0.2em;
      margin-bottom: 30px;
      background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .controls-panel {
      background: rgba(255, 255, 255, 0.05);
      padding: 25px;
      border-radius: 10px;
      margin-bottom: 30px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .upload-area {
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-area:hover {
      border-color: rgba(255, 255, 255, 0.6);
      background: rgba(255, 255, 255, 0.05);
    }

    .upload-area.has-image {
      border-color: #4ecdc4;
      background: rgba(78, 205, 196, 0.1);
    }

    input[type="file"] {
      display: none;
    }

    .upload-icon {
      font-size: 3rem;
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 8px;
      letter-spacing: 0.05em;
    }

    textarea {
      width: 100%;
      min-height: 100px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 12px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      resize: vertical;
      margin-bottom: 15px;
    }

    textarea:focus {
      outline: none;
      border-color: #4ecdc4;
    }

    .slider-group {
      margin-bottom: 20px;
    }

    .slider-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #4ecdc4;
      border-radius: 50%;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #4ecdc4;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 150px;
      background: rgba(78, 205, 196, 0.2);
      border: 1px solid #4ecdc4;
      color: #4ecdc4;
      padding: 12px 24px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      letter-spacing: 0.05em;
    }

    button:hover {
      background: rgba(78, 205, 196, 0.4);
      transform: translateY(-2px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    button.primary {
      background: #4ecdc4;
      color: #000;
      font-weight: bold;
    }

    button.primary:hover {
      background: #5eddd4;
    }

    #output {
      background: rgba(0, 0, 0, 0.6);
      padding: 30px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #portrait {
      font-family: 'Courier New', monospace;
      font-size: 6px;
      line-height: 1.1;
      letter-spacing: 0.03em;
      color: #ffffff;
      white-space: pre;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
      max-width: 100%;
      overflow-x: auto;
    }

    #placeholder {
      text-align: center;
      color: #555;
    }

    #placeholder .icon {
      font-size: 4rem;
      margin-bottom: 15px;
      opacity: 0.3;
    }

    canvas {
      display: none;
    }

    .tips {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.3);
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      font-size: 0.85rem;
      color: #ff6b6b;
    }

    .tips strong {
      display: block;
      margin-bottom: 8px;
    }

    @media (max-width: 768px) {
      h1 { font-size: 1.5rem; }
      .button-group { flex-direction: column; }
      button { min-width: 100%; }
    }
  </style>
</head>
<body>

<div class="container">
  <h1>âœ¦ TEXT PORTRAIT GENERATOR âœ¦</h1>

  <div class="controls-panel">
    <div class="upload-area" id="uploadArea" onclick="document.getElementById('imageInput').click()">
      <div class="upload-icon">ðŸ“¸</div>
      <div id="uploadText">Click to upload your photo</div>
      <div style="font-size: 0.75rem; color: #666; margin-top: 8px;">Best with face photos â€¢ JPG, PNG</div>
    </div>
    <input type="file" id="imageInput" accept="image/*">

    <label>Your Text (this will create the portrait):</label>
    <textarea id="textInput" placeholder="Type or paste any text here - song lyrics, quotes, poems, etc.">Lights go down and the night is calling to me yeah I hear voices singing songs in the street And I know that we won't be going home for so long for so long But I know that I won't be on my own yeah</textarea>

    <div class="slider-group">
      <div class="slider-header">
        <label>Portrait Width (characters)</label>
        <span id="widthValue">140</span>
      </div>
      <input type="range" id="widthSlider" min="60" max="200" value="140">
    </div>

    <div class="slider-group">
      <div class="slider-header">
        <label>Contrast</label>
        <span id="contrastValue">1.5</span>
      </div>
      <input type="range" id="contrastSlider" min="0.5" max="3" step="0.1" value="1.5">
    </div>

    <div class="slider-group">
      <div class="slider-header">
        <label>Brightness</label>
        <span id="brightnessValue">1.0</span>
      </div>
      <input type="range" id="brightnessSlider" min="0.5" max="2" step="0.1" value="1.0">
    </div>

    <div class="button-group">
      <button class="primary" id="generateBtn" disabled>âš¡ GENERATE PORTRAIT</button>
      <button id="downloadBtn" disabled>ðŸ’¾ Save as PNG</button>
      <button id="copyBtn" disabled>ðŸ“‹ Copy Text</button>
    </div>

    <div class="tips">
      <strong>ðŸ’¡ Tips for Best Results:</strong>
      â€¢ Use high-contrast face photos with good lighting<br>
      â€¢ Clear background works better than busy backgrounds<br>
      â€¢ Adjust sliders after generating to fine-tune the portrait<br>
      â€¢ Longer text creates more detailed portraits
    </div>
  </div>

  <div id="output">
    <div id="placeholder">
      <div class="icon">ðŸŽ¨</div>
      <div>Upload a photo and click Generate to see your text portrait</div>
    </div>
  </div>
</div>

<canvas id="imageCanvas"></canvas>
<canvas id="downloadCanvas"></canvas>

<script>
  let uploadedImage = null;

  // DOM elements
  const imageInput = document.getElementById('imageInput');
  const uploadArea = document.getElementById('uploadArea');
  const uploadText = document.getElementById('uploadText');
  const textInput = document.getElementById('textInput');
  const widthSlider = document.getElementById('widthSlider');
  const contrastSlider = document.getElementById('contrastSlider');
  const brightnessSlider = document.getElementById('brightnessSlider');
  const generateBtn = document.getElementById('generateBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const copyBtn = document.getElementById('copyBtn');
  const output = document.getElementById('output');

  // Update slider values
  widthSlider.oninput = () => document.getElementById('widthValue').textContent = widthSlider.value;
  contrastSlider.oninput = () => document.getElementById('contrastValue').textContent = parseFloat(contrastSlider.value).toFixed(1);
  brightnessSlider.oninput = () => document.getElementById('brightnessValue').textContent = parseFloat(brightnessSlider.value).toFixed(1);

  // Handle image upload
  imageInput.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (ev) => {
      const img = new Image();
      img.onload = () => {
        uploadedImage = img;
        uploadArea.classList.add('has-image');
        uploadText.innerHTML = `<strong>âœ“ Image loaded: ${file.name}</strong><br><span style="font-size:0.75rem">Click to change</span>`;
        generateBtn.disabled = false;
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  };

  // Generate portrait
  generateBtn.onclick = () => {
    if (!uploadedImage) {
      alert('Please upload an image first!');
      return;
    }

    const text = textInput.value.trim() || 'Text Portrait ';
    const cols = parseInt(widthSlider.value);
    const contrastFactor = parseFloat(contrastSlider.value);
    const brightnessFactor = parseFloat(brightnessSlider.value);

    const charAspect = 0.55;
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d');

    const scale = cols / uploadedImage.width;
    const rows = Math.floor(uploadedImage.height * scale * charAspect);
    canvas.width = cols;
    canvas.height = rows;

    ctx.drawImage(uploadedImage, 0, 0, cols, rows);
    const imageData = ctx.getImageData(0, 0, cols, rows);
    const data = imageData.data;

    let textIndex = 0;
    let result = '';

    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        const idx = (y * cols + x) * 4;
        let r = data[idx], g = data[idx + 1], b = data[idx + 2];

        // Grayscale
        let gray = 0.299 * r + 0.587 * g + 0.114 * b;

        // Brightness
        gray = gray * brightnessFactor;

        // Contrast
        gray = (gray - 128) * contrastFactor + 128;
        gray = Math.max(0, Math.min(255, gray));

        // Threshold
        const threshold = 128;
        if (gray < threshold) {
          let ch = text[textIndex % text.length];
          textIndex++;
          while (ch === '\n' || ch === '\r') {
            textIndex++;
            ch = text[textIndex % text.length];
          }
          result += ch;
        } else {
          result += ' ';
        }
      }
      result += '\n';
    }

    // Display portrait
    output.innerHTML = '<pre id="portrait"></pre>';
    document.getElementById('portrait').textContent = result;
    
    downloadBtn.disabled = false;
    copyBtn.disabled = false;
  };

  // Download as PNG
  downloadBtn.onclick = () => {
    const pre = document.getElementById('portrait');
    if (!pre) return;

    const lines = pre.textContent.split('\n');
    const fontSize = 7;
    const lineHeight = Math.floor(fontSize * 1.15);
    const charWidth = fontSize * 0.6;
    const padding = 40;

    const maxCols = Math.max(...lines.map(l => l.length));
    const w = Math.ceil(maxCols * charWidth) + padding * 2;
    const h = lines.length * lineHeight + padding * 2;

    const canvas = document.getElementById('downloadCanvas');
    canvas.width = w;
    canvas.height = h;
    const ctx = canvas.getContext('2d');

    ctx.fillStyle = '#000000';
    ctx.fillRect(0, 0, w, h);
    ctx.fillStyle = '#ffffff';
    ctx.font = `${fontSize}px "Courier New", monospace`;

    lines.forEach((line, i) => {
      ctx.fillText(line, padding, padding + (i + 1) * lineHeight);
    });

    const link = document.createElement('a');
    link.download = 'text-portrait.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  };

  // Copy to clipboard
  copyBtn.onclick = () => {
    const pre = document.getElementById('portrait');
    if (!pre) return;

    navigator.clipboard.writeText(pre.textContent).then(() => {
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'âœ“ Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    });
  };
</script>

</body>
</html>
